# -*- coding: utf-8 -*-
"""demo_app_dash.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14-riuo7dzyiqTdoac55gaxGoSX76pDHI
"""

import dash
from dash import dcc, html, Input, Output
import plotly.express as px
import pandas as pd
import numpy as np

np.random.seed(42)

# Create Date Range
dates = pd.date_range("2024-01-01", "2025-12-21")

companies = ["TCS", "INFOSYS", "WIPRO"]

data = []

# Generate Dummy Stock Data
for company in companies:
    price = 1000 + np.random.randint(0, 200)
    for date in dates:
        price += np.random.normal(0, 8)
        volume = np.random.randint(1000, 8000)

        data.append({
            "Date": date,
            "Company": company,
            "Price": round(price, 2),
            "Volume": volume
        })

df = pd.DataFrame(data)

# Initialize App
app = dash.Dash(__name__)
app.title = "STOCK DASHBOARD"

# Layout
app.layout = html.Div([

    html.H1("STOCK ANALYTICS DASHBOARD", style={'textAlign': 'center'}),

    html.Div([

        dcc.Dropdown(
            id='company-dropdown',
            options=[{'label': c, 'value': c} for c in df['Company'].unique()],
            value='TCS',
            clearable=False,
            style={'width': '40%', 'display': 'inline-block'}
        ),

        dcc.DatePickerRange(
            id='date-picker',
            start_date=df['Date'].min(),
            end_date=df['Date'].max(),
            style={'width': '50%', 'display': 'inline-block', 'marginLeft': '5%'}
        )

    ]),

    html.Br(),

    # KPI Card
    html.Div(
        id='daily-change-card',
        style={
            'padding': '20px',
            'backgroundColor': '#f4f4f4',
            'width': '25%',
            'textAlign': 'center',
            'fontSize': '20px',
            'borderRadius': '10px',
            'margin': 'auto'
        }
    ),

    html.Br(),

    dcc.Graph(id='price-line-chart'),
    dcc.Graph(id='volume-bar-chart')

])


# Callback
@app.callback(
    Output('price-line-chart', 'figure'),
    Output('volume-bar-chart', 'figure'),
    Output('daily-change-card', 'children'),
    Input('company-dropdown', 'value'),
    Input('date-picker', 'start_date'),
    Input('date-picker', 'end_date')
)
def update_dashboard(selected_company, start_date, end_date):

    # Filter Data
    filtered = df[
        (df['Company'] == selected_company) &
        (df['Date'] >= start_date) &
        (df['Date'] <= end_date)
    ]

    # Line Chart
    price_fig = px.line(
        filtered,
        x="Date",
        y="Price",
        title=f"{selected_company} Stock Price"
    )

    # Bar Chart
    volume_fig = px.bar(
        filtered,
        x="Date",
        y="Volume",
        title=f"{selected_company} Trading Volume"
    )

    # Daily % Change
    if len(filtered) > 1:
        latest = filtered.iloc[-1]["Price"]
        previous = filtered.iloc[-2]["Price"]
        daily_change = ((latest - previous) / previous) * 100
    else:
        daily_change = 0

    kpi_text = f"Daily Change: {daily_change:.2f}%"

    return price_fig, volume_fig, kpi_text


# Run App
if __name__ == "__main__":
    app.run(debug=True)